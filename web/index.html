<!DOCTYPE html><html><head><meta charset="utf-8"><title>MiMo2API</title>
<style>*{box-sizing:border-box;font-family:system-ui}body{max-width:800px;margin:40px auto;padding:20px;background:#f5f5f5}.card{background:#fff;padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}h2{margin-top:0}textarea,input{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;margin-bottom:10px}textarea{height:150px;font-family:monospace;font-size:12px}button{background:#007bff;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;margin-right:10px}button:hover{background:#0056b3}button.danger{background:#dc3545}button.success{background:#28a745}.account{background:#f8f9fa;padding:10px;margin:10px 0;border-radius:4px;display:flex;justify-content:space-between}.status{padding:10px;border-radius:4px;margin:10px 0}.status.success{background:#d4edda;color:#155724}.status.error{background:#f8d7da;color:#721c24}</style></head><body>
<h1>MiMo2API 管理</h1>
<div class="card"><h2>API Keys</h2><input type="text" id="apiKeys" placeholder="sk-key1,sk-key2"><button onclick="saveKeys()">保存</button></div>
<div class="card"><h2>添加账号</h2><details style="margin-bottom:10px;color:#666"><summary style="cursor:pointer;color:#007bff">如何获取凭证?</summary><ol style="margin:10px 0;padding-left:20px;line-height:1.8"><li>登录 <a href="https://aistudio.xiaomimimo.com" target="_blank">aistudio.xiaomimimo.com</a></li><li>打开浏览器开发者工具 → Network</li><li>发送一条消息，找到 <code>chat</code> 请求</li><li>右键 → Copy as cURL</li><li>粘贴到下方输入框</li></ol></details><textarea id="curl" placeholder="curl 'https://aistudio.xiaomimimo.com/...'"></textarea><button onclick="parse()">解析</button><div id="parseResult"></div></div>
<div class="card"><h2>已配置账号</h2><div id="accounts"></div></div>
<script>
let cfg={api_keys:'',mimo_accounts:[]},parsed=null;
async function load(){cfg=await(await fetch('/api/config')).json();document.getElementById('apiKeys').value=cfg.api_keys||'';render()}
function render(){const d=document.getElementById('accounts');d.innerHTML=cfg.mimo_accounts?.length?cfg.mimo_accounts.map((a,i)=>'<div class="account"><span>ID:'+a.user_id+'</span><button class="danger" onclick="del('+i+')">删除</button></div>').join(''):'<p>无</p>'}
async function saveKeys(){cfg.api_keys=document.getElementById('apiKeys').value;await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(cfg)});alert('已保存')}
async function parse(){const r=await fetch('/api/parse-curl',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({curl:document.getElementById('curl').value})});if(!r.ok){document.getElementById('parseResult').innerHTML='<div class="status error">解析失败</div>';return}parsed=await r.json();document.getElementById('parseResult').innerHTML='<div class="status success">解析成功 ID:'+parsed.user_id+'</div><button onclick="test()">测试</button><button class="success" onclick="save()">添加</button><div id="testR"></div>'}
async function test(){document.getElementById('testR').innerHTML='<div class="status">测试中...</div>';const r=await(await fetch('/api/test-account',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(parsed)})).json();document.getElementById('testR').innerHTML=r.success?'<div class="status success">成功:'+r.response+'</div>':'<div class="status error">失败:'+r.error+'</div>'}
async function save(){if(!parsed)return;cfg.mimo_accounts=cfg.mimo_accounts||[];cfg.mimo_accounts.push(parsed);await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(cfg)});parsed=null;document.getElementById('curl').value='';document.getElementById('parseResult').innerHTML='<div class="status success">已添加</div>';load()}
async function del(i){if(!confirm('确定?'))return;cfg.mimo_accounts.splice(i,1);await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(cfg)});load()}
load();
</script></body></html>
